@page
@model CitasEPS.Pages.UserDashboards.Patient.PatientIndexModel
@using Microsoft.AspNetCore.Identity
@using CitasEPS.Models
@inject SignInManager<User> UserManagerAccessor
@inject UserManager<User> AspNetUserManager

@{
    ViewData["Title"] = "Portal del Paciente - VitalCare";
    var currentUser = await AspNetUserManager.GetUserAsync(User);
    var userFirstName = currentUser?.FirstName;
}

<!-- Hero para Paciente con Imagen -->
<div class="container-fluid text-center py-4 mb-4">
    <div class="row justify-content-center align-items-center">
        <div class="col-lg-6">
            <div class="patient-welcome-content">
                <h2 class="welcome-title mb-3 text-dark">
                    <i class="bi bi-person-heart me-2 text-success"></i>
                    @if (!string.IsNullOrEmpty(userFirstName))
                    {
                        <span>Bienvenido <strong>@userFirstName</strong></span>
                    }
                    else
                    {
                        <span>Portal del Paciente</span>
                    }
                </h2>
                <p class="welcome-subtitle text-muted">Agende sus citas médicas, consulte resultados de laboratorio y acceda a su historia clínica en VitalCare IPS</p>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="patient-image-container">
                <img src="~/images/Pacientes.png" alt="Portal del Paciente" class="img-fluid rounded-3 shadow-lg" style="max-height: 300px; width: auto;">
            </div>
        </div>
    </div>
</div>

<!-- Main Patient Dashboard Content -->
<div class="container mt-5 py-2">
    <div id="patientPanelDashboard" class="row justify-content-center">
        <div class="col-lg-11 col-xl-10">
            <!-- Header simplificado -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #1a5e3a 0%, #2d7a4a 100%); color: white;">
                        <div class="card-body text-center py-4">
                            <h2 class="mb-2" style="color: white;">
                                <i class="bi bi-person-heart me-2" style="color: white;"></i>
                                @if (!string.IsNullOrEmpty(userFirstName))
                                {
                                    <span style="color: white;">Bienvenido, <strong>@userFirstName</strong></span>
                                }
                                else
                                {
                                    <span style="color: white;">Portal del Paciente</span>
                                }
                            </h2>
                            <p class="mb-0" style="color: rgba(255,255,255,0.85);">Gestiona tu salud de manera simple y segura</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard rápido -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a);">
                        <div class="card-body text-center py-4">
                            <i class="bi bi-calendar-week fs-2 mb-2" style="color: white;"></i>
                            <h6 class="card-title" style="color: white;">Próxima Cita</h6>
                            <p class="card-text small mb-0" id="patientNextAppointmentDisplay" style="color: rgba(255,255,255,0.85);">Cargando...</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a);">
                        <div class="card-body text-center py-4">
                            <i class="bi bi-prescription2 fs-2 mb-2" style="color: white;"></i>
                            <h6 class="card-title" style="color: white;">Recetas Activas</h6>
                            <p class="card-text small mb-0" style="color: rgba(255,255,255,0.85);">
                                <span id="patientPrescriptionsCount">0</span> recetas vigentes
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a);">
                        <div class="card-body text-center py-4">
                            <i class="bi bi-bell fs-2 mb-2" style="color: white;"></i>
                            <h6 class="card-title" style="color: white;">Recordatorios</h6>
                            <p class="card-text small mb-0" style="color: rgba(255,255,255,0.85);">
                                <span id="activeRemindersCount">0</span> pendientes
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones principales -->
            <div class="row g-4 mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-lg h-100 feature-card-hover">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon-wrapper mb-3">
                                <i class="bi bi-calendar-plus-fill fs-1 feature-icon-main" style="color: #1a5e3a;"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">Agendar Cita</h5>
                            <p class="card-text text-muted mb-4">Programa una nueva consulta médica según tu disponibilidad</p>
                            <a asp-page="/Appointments/Create" class="btn btn-lg w-100 fw-bold text-white" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a); border: none;">
                                <i class="bi bi-arrow-right-circle me-2"></i>Agendar Ahora
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-lg h-100 feature-card-hover">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon-wrapper mb-3">
                                <i class="bi bi-calendar-check-fill fs-1 feature-icon-main" style="color: #1a5e3a;"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">Mis Citas</h5>
                            <p class="card-text text-muted mb-4">Revisa y gestiona todas tus citas médicas programadas</p>
                            <a asp-page="/Appointments/Index" class="btn btn-lg w-100 fw-bold text-white" style="background: linear-gradient(135deg, #0f4a2d, #166534); border: none;">
                                <i class="bi bi-list-check me-2"></i>Ver Mis Citas
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-lg h-100 feature-card-hover">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon-wrapper mb-3">
                                <i class="bi bi-journal-medical fs-1 feature-icon-main" style="color: #0f172a;"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">Mis Recetas</h5>
                            <p class="card-text text-muted mb-4">Consulta las recetas médicas emitidas por tus doctores</p>
                            <a asp-page="/Appointments/MyPrescriptions" class="btn btn-lg w-100 fw-bold text-white" style="background: linear-gradient(135deg, #0f4a2d, #166534); border: none;">
                                <i class="bi bi-eye me-2"></i>Ver Recetas
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información adicional en acordeón -->
            <div class="row">
                <div class="col-12">
                    <div class="accordion shadow-sm" id="patientInfoAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#healthInfo">
                                    <i class="bi bi-heart-pulse me-2 text-success"></i>
                                    Estado de Salud y Historial
                                </button>
                            </h2>
                            <div id="healthInfo" class="accordion-collapse collapse" data-bs-parent="#patientInfoAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="list-group">
                                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span><i class="bi bi-activity text-primary me-2"></i>Última Consulta</span>
                                                    <small class="text-muted" id="lastConsultationDate">Cargando...</small>
                                                </div>
                                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span><i class="bi bi-calendar-plus text-warning me-2"></i>Próximo Chequeo</span>
                                                    <small class="text-muted" id="nextCheckupDate">Cargando...</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-grid gap-2">
                                                <a href="/Patient/HealthStatus" class="btn btn-lg fw-bold text-white" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a); border: none;">
                                                    <i class="bi bi-clipboard-data me-2"></i>Ver Estado Completo
                                                </a>
                                                <a href="/Patient/MedicalHistory" class="btn btn-lg fw-bold text-white" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a); border: none;">
                                                    <i class="bi bi-file-medical me-2"></i>Historial Médico
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#messagesInfo">
                                    <i class="bi bi-chat-dots me-2 text-info"></i>
                                    Mensajes y Comunicación
                                </button>
                            </h2>
                            <div id="messagesInfo" class="accordion-collapse collapse" data-bs-parent="#patientInfoAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-8">
                                            <div id="messagesContainer">
                                                <p class="text-muted small">
                                                    <i class="bi bi-info-circle text-info me-1"></i>
                                                    Aquí aparecerán los mensajes de tus médicos y notificaciones del sistema.
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="d-grid">
                                                <a href="/Patient/Messages" class="btn btn-lg fw-bold text-white" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a); border: none;">
                                                    <i class="bi bi-envelope me-2"></i>
                                                    Ver Mensajes 
                                                    <span class="badge bg-light text-dark ms-2" id="unreadMessagesCount">0</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#profileInfo">
                                    <i class="bi bi-person-gear me-2 text-secondary"></i>
                                    Configuración de Perfil
                                </button>
                            </h2>
                            <div id="profileInfo" class="accordion-collapse collapse" data-bs-parent="#patientInfoAccordion">
                                <div class="accordion-body text-center">
                                    <p class="text-muted mb-3">Mantén actualizada tu información personal y de contacto</p>
                                    <a asp-area="Identity" asp-page="/Account/Manage/Index" class="btn btn-lg fw-bold text-white" style="background: linear-gradient(135deg, #1a5e3a, #2d7a4a); border: none;">
                                        <i class="bi bi-pencil-square me-2"></i>Actualizar Mi Perfil
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 
